<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Utils::Curl
  
    &mdash; Homebrew Ruby API
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Utils::Curl";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Utils.html" title="Utils (module)">Utils</a></span></span>
     &raquo; 
    <span class="title">Curl</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Utils::Curl
  
  
  <span class="private note title">Private</span>
</h1>
<div class="box_info">
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd><span class='object_link'><a href="../SystemCommand/Mixin.html" title="SystemCommand::Mixin (module)">SystemCommand::Mixin</a></span></dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="../SystemCommand/Mixin.html" title="SystemCommand::Mixin (module)">SystemCommand::Mixin</a></span></dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../Cask/Audit.html" title="Cask::Audit (class)">Cask::Audit</a></span>, <span class='object_link'><a href="../CurlDownloadStrategy.html" title="CurlDownloadStrategy (class)">CurlDownloadStrategy</a></span>, <span class='object_link'><a href="../Homebrew/FormulaAuditor.html" title="Homebrew::FormulaAuditor (class)">Homebrew::FormulaAuditor</a></span>, <span class='object_link'><a href="../Homebrew/Livecheck/Strategy.html" title="Homebrew::Livecheck::Strategy (module)">Homebrew::Livecheck::Strategy</a></span>, <span class='object_link'><a href="../Homebrew/ResourceAuditor.html" title="Homebrew::ResourceAuditor (class)">Homebrew::ResourceAuditor</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>utils/curl.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This module is part of a private API.</strong>
  This module may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this module if possible, as it may be removed or changed without warning.
</p>
<p>Helper function for interacting with <code>curl</code>.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_path_cache-class_method" title="clear_path_cache (class method)">.<strong>clear_path_cache</strong>  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl-class_method" title="curl (class method)">.<strong>curl</strong>(*args, print_stdout: true, **options)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_args-class_method" title="curl_args (class method)">.<strong>curl_args</strong>(*extra_args, connect_timeout: nil, max_time: nil, retries: Homebrew::EnvConfig.curl_retries.to_i, retry_max_time: nil, show_output: false, show_error: true, user_agent: nil, referer: nil)  &#x21d2; Array&lt;T.untyped&gt; </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_check_http_content-class_method" title="curl_check_http_content (class method)">.<strong>curl_check_http_content</strong>(url, url_type, specs: {}, user_agents: [:default], referer: nil, check_content: false, strict: false, use_homebrew_curl: false)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_download-class_method" title="curl_download (class method)">.<strong>curl_download</strong>(*args, to: nil, try_partial: false, **options)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_executable-class_method" title="curl_executable (class method)">.<strong>curl_executable</strong>(use_homebrew_curl: false)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_headers-class_method" title="curl_headers (class method)">.<strong>curl_headers</strong>(*args, wanted_headers: [], **options)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_http_content_headers_and_checksum-class_method" title="curl_http_content_headers_and_checksum (class method)">.<strong>curl_http_content_headers_and_checksum</strong>(url, specs: {}, hash_needed: false, use_homebrew_curl: false, user_agent: :default, referer: nil)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_output-class_method" title="curl_output (class method)">.<strong>curl_output</strong>(*args, **options)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_path-class_method" title="curl_path (class method)">.<strong>curl_path</strong>  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_response_follow_redirections-class_method" title="curl_response_follow_redirections (class method)">.<strong>curl_response_follow_redirections</strong>(responses, base_url)  &#x21d2; String </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Returns the final URL by following location headers in cURL responses.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_response_last_location-class_method" title="curl_response_last_location (class method)">.<strong>curl_response_last_location</strong>(responses, absolutize: false, base_url: nil)  &#x21d2; String<sup>?</sup> </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Returns the URL from the last location header found in cURL responses, if any.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_supports_tls13%3F-class_method" title="curl_supports_tls13? (class method)">.<strong>curl_supports_tls13?</strong>  &#x21d2; Boolean </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#curl_with_workarounds-class_method" title="curl_with_workarounds (class method)">.<strong>curl_with_workarounds</strong>(*args, secrets: nil, print_stdout: nil, print_stderr: nil, debug: nil, verbose: nil, env: {}, timeout: nil, use_homebrew_curl: false, **options)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#http_status_ok%3F-class_method" title="http_status_ok? (class method)">.<strong>http_status_ok?</strong>(status)  &#x21d2; Boolean </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_curl_output-class_method" title="parse_curl_output (class method)">.<strong>parse_curl_output</strong>(output, max_iterations: 25)  &#x21d2; Hash{Symbol =&gt; T.untyped} </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Separates the output text from <code>curl</code> into an array of HTTP responses and the final response body (i.e. content).</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#url_protected_by_cloudflare%3F-class_method" title="url_protected_by_cloudflare? (class method)">.<strong>url_protected_by_cloudflare?</strong>(response)  &#x21d2; Boolean </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Check if a URL is protected by CloudFlare (e.g. badlion.net and jaxx.io).</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#url_protected_by_incapsula%3F-class_method" title="url_protected_by_incapsula? (class method)">.<strong>url_protected_by_incapsula?</strong>(response)  &#x21d2; Boolean </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Check if a URL is protected by Incapsula (e.g. corsair.com).</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../SystemCommand/Mixin.html" title="SystemCommand::Mixin (module)">SystemCommand::Mixin</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../SystemCommand/Mixin.html#system_command-instance_method" title="SystemCommand::Mixin#system_command (method)">system_command</a></span>, <span class='object_link'><a href="../SystemCommand/Mixin.html#system_command!-instance_method" title="SystemCommand::Mixin#system_command! (method)">system_command!</a></span></p>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="clear_path_cache-class_method">
  
    .<strong>clear_path_cache</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 45</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_path_cache'>clear_path_cache</span>
  <span class='ivar'>@curl_path</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl-class_method">
  
    .<strong>curl</strong>(*args, print_stdout: true, **options)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


177
178
179
180
181</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 177</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl'>curl</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>print_stdout:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_curl_with_workarounds'>curl_with_workarounds</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>print_stdout:</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_assert_success!'>assert_success!</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_args-class_method">
  
    .<strong>curl_args</strong>(*extra_args, connect_timeout: nil, max_time: nil, retries: Homebrew::EnvConfig.curl_retries.to_i, retry_max_time: nil, show_output: false, show_error: true, user_agent: nil, referer: nil)  &#x21d2; <tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'>T</span>.untyped&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>extra_args</span>
      
      
        <span class='type'>(<tt><span class='object_link'>T</span>.untyped</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>connect_timeout</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Float</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>max_time</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Float</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>retries</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>Homebrew::EnvConfig.curl_retries.to_i</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>retry_max_time</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Float</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>show_output</span>
      
      
        <span class='type'>(<tt>Boolean</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>show_error</span>
      
      
        <span class='type'>(<tt>Boolean</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>user_agent</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>referer</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'>T</span>.untyped&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_args'>curl_args</span><span class='lparen'>(</span>
  <span class='op'>*</span><span class='id identifier rubyid_extra_args'>extra_args</span><span class='comma'>,</span>
  <span class='label'>connect_timeout:</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>max_time:</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>retries:</span> <span class='const'><span class='object_link'><a href="../Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Homebrew/EnvConfig.html" title="Homebrew::EnvConfig (module)">EnvConfig</a></span></span><span class='period'>.</span><span class='id identifier rubyid_curl_retries'>curl_retries</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span>
  <span class='label'>retry_max_time:</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>show_output:</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='label'>show_error:</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='label'>user_agent:</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>referer:</span> <span class='kw'>nil</span>
<span class='rparen'>)</span>
  <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='comment'># do not load .curlrc unless requested (must be the first argument)
</span>  <span class='id identifier rubyid_curlrc'>curlrc</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Homebrew/EnvConfig.html" title="Homebrew::EnvConfig (module)">EnvConfig</a></span></span><span class='period'>.</span><span class='id identifier rubyid_curlrc'>curlrc</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_curlrc'>curlrc</span><span class='op'>&amp;.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='comment'># If the file exists, we still want to disable loading the default curlrc.
</span>    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--disable</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--config</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_curlrc'>curlrc</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_curlrc'>curlrc</span>
    <span class='comment'># This matches legacy behavior: `HOMEBREW_CURLRC` was a bool,
</span>    <span class='comment'># omitting `--disable` when present.
</span>  <span class='kw'>else</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--disable</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># echo any cookies received on a redirect
</span>  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--cookie</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/dev/null</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--globoff</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--show-error</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_show_error'>show_error</span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--user-agent</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='kw'>case</span> <span class='id identifier rubyid_user_agent'>user_agent</span>
  <span class='kw'>when</span> <span class='symbol'>:browser</span><span class='comma'>,</span> <span class='symbol'>:fake</span>
    <span class='const'><span class='object_link'><a href="../top-level-namespace.html#HOMEBREW_USER_AGENT_FAKE_SAFARI-constant" title="HOMEBREW_USER_AGENT_FAKE_SAFARI (constant)">HOMEBREW_USER_AGENT_FAKE_SAFARI</a></span></span>
  <span class='kw'>when</span> <span class='symbol'>:default</span><span class='comma'>,</span> <span class='kw'>nil</span>
    <span class='const'><span class='object_link'><a href="../top-level-namespace.html#HOMEBREW_USER_AGENT_CURL-constant" title="HOMEBREW_USER_AGENT_CURL (constant)">HOMEBREW_USER_AGENT_CURL</a></span></span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></span>
    <span class='id identifier rubyid_user_agent'>user_agent</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:user_agent must be :browser/:fake, :default, or a String</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--header</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Accept-Language: en</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>if</span> <span class='id identifier rubyid_show_output'>show_output</span> <span class='op'>!=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--fail</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--progress-bar</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="../Context.html" title="Context (module)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_current'><span class='object_link'><a href="../Context.html#current-class_method" title="Context.current (method)">current</a></span></span><span class='period'>.</span><span class='id identifier rubyid_verbose?'>verbose?</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--verbose</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Homebrew/EnvConfig.html" title="Homebrew::EnvConfig (module)">EnvConfig</a></span></span><span class='period'>.</span><span class='id identifier rubyid_curl_verbose?'>curl_verbose?</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--silent</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='op'>!</span><span class='gvar'>$stdout</span><span class='period'>.</span><span class='id identifier rubyid_tty?'>tty?</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="../Context.html" title="Context (module)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_current'><span class='object_link'><a href="../Context.html#current-class_method" title="Context.current (method)">current</a></span></span><span class='period'>.</span><span class='id identifier rubyid_quiet?'>quiet?</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--connect-timeout</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--max-time</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_max_time'>max_time</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_max_time'>max_time</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='comment'># A non-positive integer (e.g. 0) or `nil` will omit this argument
</span>  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--retry</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_retries'>retries</span> <span class='kw'>if</span> <span class='id identifier rubyid_retries'>retries</span><span class='op'>&amp;.</span><span class='id identifier rubyid_positive?'>positive?</span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--retry-max-time</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_retry_max_time'>retry_max_time</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span> <span class='kw'>if</span> <span class='id identifier rubyid_retry_max_time'>retry_max_time</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--referer</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_referer'>referer</span> <span class='kw'>if</span> <span class='id identifier rubyid_referer'>referer</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>+</span> <span class='id identifier rubyid_extra_args'>extra_args</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_check_http_content-class_method">
  
    .<strong>curl_check_http_content</strong>(url, url_type, specs: {}, user_agents: [:default], referer: nil, check_content: false, strict: false, use_homebrew_curl: false)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 272</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_check_http_content'>curl_check_http_content</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='id identifier rubyid_url_type'>url_type</span><span class='comma'>,</span> <span class='label'>specs:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>user_agents:</span> <span class='lbracket'>[</span><span class='symbol'>:default</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>referer:</span> <span class='kw'>nil</span><span class='comma'>,</span>
                            <span class='label'>check_content:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>strict:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>use_homebrew_curl:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_secure_url'>secure_url</span> <span class='op'>=</span> <span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Ahttp:</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_secure_details'>secure_details</span> <span class='op'>=</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_nilable'>nilable</span><span class='lparen'>(</span><span class='const'>T</span><span class='op'>::</span><span class='const'>Hash</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></span><span class='comma'>,</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_untyped'>untyped</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_hash_needed'>hash_needed</span> <span class='op'>=</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='kw'>false</span><span class='comma'>,</span> <span class='const'>T</span><span class='op'>::</span><span class='const'>Boolean</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_url'>url</span> <span class='op'>!=</span> <span class='id identifier rubyid_secure_url'>secure_url</span>
    <span class='id identifier rubyid_user_agents'>user_agents</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_agent'>user_agent</span><span class='op'>|</span>
      <span class='id identifier rubyid_secure_details'>secure_details</span> <span class='op'>=</span> <span class='kw'>begin</span>
        <span class='id identifier rubyid_curl_http_content_headers_and_checksum'>curl_http_content_headers_and_checksum</span><span class='lparen'>(</span>
          <span class='id identifier rubyid_secure_url'>secure_url</span><span class='comma'>,</span>
          <span class='label'>specs:</span><span class='comma'>,</span>
          <span class='label'>hash_needed:</span>       <span class='kw'>true</span><span class='comma'>,</span>
          <span class='label'>use_homebrew_curl:</span><span class='comma'>,</span>
          <span class='label'>user_agent:</span><span class='comma'>,</span>
          <span class='label'>referer:</span><span class='comma'>,</span>
        <span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_http_status_ok?'>http_status_ok?</span><span class='lparen'>(</span><span class='id identifier rubyid_secure_details'>secure_details</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_hash_needed'>hash_needed</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_user_agents'>user_agents</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_user_agent'>user_agent</span><span class='rbracket'>]</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_details'>details</span> <span class='op'>=</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_nilable'>nilable</span><span class='lparen'>(</span><span class='const'>T</span><span class='op'>::</span><span class='const'>Hash</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></span><span class='comma'>,</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_untyped'>untyped</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_user_agents'>user_agents</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_agent'>user_agent</span><span class='op'>|</span>
    <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_details'>details</span> <span class='op'>=</span> <span class='id identifier rubyid_curl_http_content_headers_and_checksum'>curl_http_content_headers_and_checksum</span><span class='lparen'>(</span>
        <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span>
        <span class='label'>specs:</span><span class='comma'>,</span>
        <span class='label'>hash_needed:</span><span class='comma'>,</span>
        <span class='label'>use_homebrew_curl:</span><span class='comma'>,</span>
        <span class='label'>user_agent:</span><span class='comma'>,</span>
        <span class='label'>referer:</span><span class='comma'>,</span>
      <span class='rparen'>)</span>

      <span class='comment'># Retry on network issues
</span>      <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:exit_status</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='int'>52</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:exit_status</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='int'>56</span>

      <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>&gt;=</span> <span class='const'><span class='object_link'><a href="../Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Homebrew/EnvConfig.html" title="Homebrew::EnvConfig (module)">EnvConfig</a></span></span><span class='period'>.</span><span class='id identifier rubyid_curl_retries'>curl_retries</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='kw'>end</span>

    <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_http_status_ok?'>http_status_ok?</span><span class='lparen'>(</span><span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url_type'>url_type</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not reachable</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_http_status_ok?'>http_status_ok?</span><span class='lparen'>(</span><span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:responses</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
      <span class='id identifier rubyid_url_protected_by_cloudflare?'>url_protected_by_cloudflare?</span><span class='lparen'>(</span><span class='id identifier rubyid_response'>response</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_url_protected_by_incapsula?'>url_protected_by_incapsula?</span><span class='lparen'>(</span><span class='id identifier rubyid_response'>response</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># https://github.com/Homebrew/brew/issues/13789
</span>    <span class='comment'># If the `:homepage` of a formula is private, it will fail an `audit`
</span>    <span class='comment'># since there&#39;s no way to specify a `strategy` with `using:` and
</span>    <span class='comment'># GitHub does not authorize access to the web UI using token
</span>    <span class='comment'>#
</span>    <span class='comment'># Strategy:
</span>    <span class='comment'># If the `:homepage` 404s, it&#39;s a GitHub link, and we have a token then
</span>    <span class='comment'># check the API (which does use tokens) for the repository
</span>    <span class='id identifier rubyid_repo_details'>repo_details</span> <span class='op'>=</span> <span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>https?://github\.com/(?&lt;user&gt;[^/]+)/(?&lt;repo&gt;[^/]+)/?.*</span><span class='regexp_end'>}</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_check_github_api'>check_github_api</span> <span class='op'>=</span> <span class='id identifier rubyid_url_type'>url_type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="../SharedAudits.html" title="SharedAudits (module)">SharedAudits</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../SharedAudits.html#URL_TYPE_HOMEPAGE-constant" title="SharedAudits::URL_TYPE_HOMEPAGE (constant)">URL_TYPE_HOMEPAGE</a></span></span> <span class='op'>&amp;&amp;</span>
                       <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>404</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span>
                       <span class='id identifier rubyid_repo_details'>repo_details</span> <span class='op'>&amp;&amp;</span>
                       <span class='const'><span class='object_link'><a href="../Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Homebrew/EnvConfig.html" title="Homebrew::EnvConfig (module)">EnvConfig</a></span></span><span class='period'>.</span><span class='id identifier rubyid_github_api_token'>github_api_token</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_check_github_api'>check_github_api</span>
      <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url_type'>url_type</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not reachable (HTTP status code </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to find homepage</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../SharedAudits.html" title="SharedAudits (module)">SharedAudits</a></span></span><span class='period'>.</span><span class='id identifier rubyid_github_repo_data'><span class='object_link'><a href="../SharedAudits.html#github_repo_data-class_method" title="SharedAudits.github_repo_data (method)">github_repo_data</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_repo_details'>repo_details</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_repo_details'>repo_details</span><span class='lbracket'>[</span><span class='symbol'>:repo</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="../Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Homebrew/EnvConfig.html" title="Homebrew::EnvConfig (module)">EnvConfig</a></span></span><span class='period'>.</span><span class='id identifier rubyid_no_insecure_redirect?'>no_insecure_redirect?</span> <span class='op'>&amp;&amp;</span>
     <span class='lparen'>(</span><span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:final_url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:final_url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url_type'>url_type</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_content'> redirects back to HTTP</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_secure_details'>secure_details</span>

  <span class='kw'>return</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_http_status_ok?'>http_status_ok?</span><span class='lparen'>(</span><span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_http_status_ok?'>http_status_ok?</span><span class='lparen'>(</span><span class='id identifier rubyid_secure_details'>secure_details</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_etag_match'>etag_match</span> <span class='op'>=</span> <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:etag</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span>
               <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:etag</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_secure_details'>secure_details</span><span class='lbracket'>[</span><span class='symbol'>:etag</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_content_length_match'>content_length_match</span> <span class='op'>=</span>
    <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:content_length</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:content_length</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_secure_details'>secure_details</span><span class='lbracket'>[</span><span class='symbol'>:content_length</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_file_match'>file_match</span> <span class='op'>=</span> <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:file_hash</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_secure_details'>secure_details</span><span class='lbracket'>[</span><span class='symbol'>:file_hash</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_http_with_https_available'>http_with_https_available</span> <span class='op'>=</span>
    <span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_secure_details'>secure_details</span><span class='lbracket'>[</span><span class='symbol'>:final_url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_secure_details'>secure_details</span><span class='lbracket'>[</span><span class='symbol'>:final_url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_etag_match'>etag_match</span> <span class='op'>||</span> <span class='id identifier rubyid_content_length_match'>content_length_match</span> <span class='op'>||</span> <span class='id identifier rubyid_file_match'>file_match</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_http_with_https_available'>http_with_https_available</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url_type'>url_type</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_content'> should use HTTPS rather than HTTP</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_check_content'>check_content</span>

  <span class='id identifier rubyid_no_protocol_file_contents'>no_protocol_file_contents</span> <span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>https?:\\?/\\?/</span><span class='regexp_end'>}</span></span>
  <span class='id identifier rubyid_http_content'>http_content</span> <span class='op'>=</span> <span class='id identifier rubyid_details'>details</span><span class='lbracket'>[</span><span class='symbol'>:file</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_scrub'>scrub</span><span class='op'>&amp;.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='id identifier rubyid_no_protocol_file_contents'>no_protocol_file_contents</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_https_content'>https_content</span> <span class='op'>=</span> <span class='id identifier rubyid_secure_details'>secure_details</span><span class='lbracket'>[</span><span class='symbol'>:file</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_scrub'>scrub</span><span class='op'>&amp;.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='id identifier rubyid_no_protocol_file_contents'>no_protocol_file_contents</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='comment'># Check for the same content after removing all protocols
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_http_content'>http_content</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_https_content'>https_content</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_http_content'>http_content</span> <span class='op'>==</span> <span class='id identifier rubyid_https_content'>https_content</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_http_with_https_available'>http_with_https_available</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url_type'>url_type</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_content'> should use HTTPS rather than HTTP</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_strict'>strict</span>

  <span class='comment'># Same size, different content after normalization
</span>  <span class='comment'># (typical causes: Generated ID, Timestamp, Unix time)
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_http_content'>http_content</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='id identifier rubyid_https_content'>https_content</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url_type'>url_type</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_content'> may be able to use HTTPS rather than HTTP. Please verify it in a browser.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_lenratio'>lenratio</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_https_content'>https_content</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>*</span> <span class='int'>100</span> <span class='op'>/</span> <span class='id identifier rubyid_http_content'>http_content</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='int'>90</span><span class='op'>..</span><span class='int'>110</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_cover?'>cover?</span><span class='lparen'>(</span><span class='id identifier rubyid_lenratio'>lenratio</span><span class='rparen'>)</span>

  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url_type'>url_type</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_content'> may be able to use HTTPS rather than HTTP. Please verify it in a browser.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_download-class_method">
  
    .<strong>curl_download</strong>(*args, to: nil, try_partial: false, **options)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 183</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_download'>curl_download</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>to:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>try_partial:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_destination'>destination</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_to'>to</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_destination'>destination</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='period'>.</span><span class='id identifier rubyid_mkpath'>mkpath</span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--location</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_try_partial'>try_partial</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_destination'>destination</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span>
    <span class='id identifier rubyid_headers'>headers</span> <span class='op'>=</span> <span class='kw'>begin</span>
      <span class='id identifier rubyid_parsed_output'>parsed_output</span> <span class='op'>=</span> <span class='id identifier rubyid_curl_headers'>curl_headers</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='label'>wanted_headers:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>accept-ranges</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_parsed_output'>parsed_output</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:responses</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='op'>&amp;.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:headers</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="../ErrorDuringExecution.html" title="ErrorDuringExecution (class)">ErrorDuringExecution</a></span></span>
      <span class='comment'># Ignore errors here and let actual download fail instead.
</span>      <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='comment'># Any value for `Accept-Ranges` other than `none` indicates that the server
</span>    <span class='comment'># supports partial requests. Its absence indicates no support.
</span>    <span class='id identifier rubyid_supports_partial'>supports_partial</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>accept-ranges</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>none</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>none</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_content_length'>content_length</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-length</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_supports_partial'>supports_partial</span>
      <span class='comment'># We&#39;ve already downloaded all bytes.
</span>      <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_destination'>destination</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='id identifier rubyid_content_length'>content_length</span>

      <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--continue-at</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--remote-time</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--output</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_destination'>destination</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_curl'>curl</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_executable-class_method">
  
    .<strong>curl_executable</strong>(use_homebrew_curl: false)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37
38
39</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 35</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_executable'>curl_executable</span><span class='lparen'>(</span><span class='label'>use_homebrew_curl:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../top-level-namespace.html#HOMEBREW_BREWED_CURL_PATH-constant" title="HOMEBREW_BREWED_CURL_PATH (constant)">HOMEBREW_BREWED_CURL_PATH</a></span></span> <span class='kw'>if</span> <span class='id identifier rubyid_use_homebrew_curl'>use_homebrew_curl</span>

  <span class='ivar'>@curl_executable</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../top-level-namespace.html#HOMEBREW_SHIMS_PATH-constant" title="HOMEBREW_SHIMS_PATH (constant)">HOMEBREW_SHIMS_PATH</a></span></span><span class='op'>/</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>shared/curl</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_headers-class_method">
  
    .<strong>curl_headers</strong>(*args, wanted_headers: [], **options)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 220</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_headers'>curl_headers</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>wanted_headers:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--request</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request_args'>request_args</span><span class='op'>|</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_curl_output'>curl_output</span><span class='lparen'>(</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--fail</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--location</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--silent</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--head</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_request_args'>request_args</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span>
      <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>
    <span class='rparen'>)</span>

    <span class='comment'># 22 means a non-successful HTTP status code, not a `curl` error, so we still got some headers.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span> <span class='op'>||</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_exit_status'>exit_status</span> <span class='op'>==</span> <span class='int'>22</span>
      <span class='id identifier rubyid_parsed_output'>parsed_output</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_curl_output'>parse_curl_output</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_stdout'>stdout</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_request_args'>request_args</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='comment'># If we didn&#39;t get any wanted header yet, retry using `GET`.
</span>        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_wanted_headers'>wanted_headers</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='op'>&amp;&amp;</span>
                <span class='id identifier rubyid_parsed_output'>parsed_output</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:responses</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_none?'>none?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:headers</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_wanted_headers'>wanted_headers</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='rbrace'>}</span>

        <span class='comment'># Some CDNs respond with 400 codes for `HEAD` but resolve with `GET`.
</span>        <span class='kw'>next</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='int'>400</span><span class='op'>..</span><span class='int'>499</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_cover?'>cover?</span><span class='lparen'>(</span><span class='id identifier rubyid_parsed_output'>parsed_output</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:responses</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='op'>&amp;.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:status_code</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='kw'>return</span> <span class='id identifier rubyid_parsed_output'>parsed_output</span> <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_assert_success!'>assert_success!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_http_content_headers_and_checksum-class_method">
  
    .<strong>curl_http_content_headers_and_checksum</strong>(url, specs: {}, hash_needed: false, use_homebrew_curl: false, user_agent: :default, referer: nil)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 402</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_http_content_headers_and_checksum'>curl_http_content_headers_and_checksum</span><span class='lparen'>(</span>
  <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='label'>specs:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>hash_needed:</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='label'>use_homebrew_curl:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>user_agent:</span> <span class='symbol'>:default</span><span class='comma'>,</span> <span class='label'>referer:</span> <span class='kw'>nil</span>
<span class='rparen'>)</span>
  <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='const'>Tempfile</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:close</span><span class='rparen'>)</span>

  <span class='comment'># Convert specs to options. This is mostly key-value options,
</span>  <span class='comment'># unless the value is a boolean in which case treat as as flag.
</span>  <span class='id identifier rubyid_specs'>specs</span> <span class='op'>=</span> <span class='id identifier rubyid_specs'>specs</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_option'>option</span><span class='comma'>,</span> <span class='id identifier rubyid_argument'>argument</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_argument'>argument</span> <span class='op'>==</span> <span class='kw'>false</span> <span class='comment'># No flag.
</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_option'>option</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_tr'>tr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_argument'>argument</span> <span class='kw'>if</span> <span class='id identifier rubyid_argument'>argument</span> <span class='op'>!=</span> <span class='kw'>true</span> <span class='comment'># It&#39;s a flag.
</span>    <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_max_time'>max_time</span> <span class='op'>=</span> <span class='id identifier rubyid_hash_needed'>hash_needed</span> <span class='op'>?</span> <span class='int'>600</span> <span class='op'>:</span> <span class='int'>25</span>
  <span class='id identifier rubyid_output'>output</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='id identifier rubyid_curl_output'>curl_output</span><span class='lparen'>(</span>
    <span class='op'>*</span><span class='id identifier rubyid_specs'>specs</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--dump-header</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--output</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--location</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span>
    <span class='label'>use_homebrew_curl:</span><span class='comma'>,</span>
    <span class='label'>connect_timeout:</span>   <span class='int'>15</span><span class='comma'>,</span>
    <span class='label'>max_time:</span><span class='comma'>,</span>
    <span class='label'>retry_max_time:</span>    <span class='id identifier rubyid_max_time'>max_time</span><span class='comma'>,</span>
    <span class='label'>user_agent:</span><span class='comma'>,</span>
    <span class='label'>referer:</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_parsed_output'>parsed_output</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_curl_output'>parse_curl_output</span><span class='lparen'>(</span><span class='id identifier rubyid_output'>output</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_responses'>responses</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed_output'>parsed_output</span><span class='lbracket'>[</span><span class='symbol'>:responses</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_final_url'>final_url</span> <span class='op'>=</span> <span class='id identifier rubyid_curl_response_last_location'>curl_response_last_location</span><span class='lparen'>(</span><span class='id identifier rubyid_responses'>responses</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_headers'>headers</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_responses'>responses</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_status_code'>status_code</span> <span class='op'>=</span> <span class='id identifier rubyid_responses'>responses</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_responses'>responses</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_etag'>etag</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>etag</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='const'>ETAG_VALUE_REGEX</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>etag</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='id identifier rubyid_content_length'>content_length</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-length</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
    <span class='id identifier rubyid_open_args'>open_args</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='comment'># Try to get encoding from Content-Type header
</span>    <span class='comment'># TODO: add guessing encoding by &lt;meta http-equiv=&quot;Content-Type&quot; ...&gt; tag
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_content_type'>content_type</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
       <span class='lparen'>(</span><span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='id identifier rubyid_content_type'>content_type</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>;\s*charset\s*=\s*([^\s]+)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
       <span class='lparen'>(</span><span class='id identifier rubyid_charset'>charset</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_open_args'>open_args</span><span class='lbracket'>[</span><span class='symbol'>:encoding</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_charset'>charset</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>ArgumentError</span>
        <span class='comment'># Unknown charset in Content-Type header
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_file_contents'>file_contents</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../File.html" title="File (class)">File</a></span></span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_must'>must</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_open_args'>open_args</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file_hash'>file_hash</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA256</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id identifier rubyid_file_contents'>file_contents</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_hash_needed'>hash_needed</span>
  <span class='kw'>end</span>

  <span class='lbrace'>{</span>
    <span class='label'>url:</span><span class='comma'>,</span>
    <span class='label'>final_url:</span><span class='comma'>,</span>
    <span class='label'>exit_status:</span>    <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span><span class='comma'>,</span>
    <span class='label'>status_code:</span><span class='comma'>,</span>
    <span class='label'>headers:</span><span class='comma'>,</span>
    <span class='label'>etag:</span><span class='comma'>,</span>
    <span class='label'>content_length:</span><span class='comma'>,</span>
    <span class='label'>file:</span>           <span class='id identifier rubyid_file_contents'>file_contents</span><span class='comma'>,</span>
    <span class='label'>file_hash:</span><span class='comma'>,</span>
    <span class='label'>responses:</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>
<span class='kw'>ensure</span>
  <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_must'>must</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_unlink'>unlink</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_output-class_method">
  
    .<strong>curl_output</strong>(*args, **options)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 216</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_output'>curl_output</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_curl_with_workarounds'>curl_with_workarounds</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>print_stderr:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>show_output:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_path-class_method">
  
    .<strong>curl_path</strong>  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 41</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_path'>curl_path</span>
  <span class='ivar'>@curl_path</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../Utils.html" title="Utils (module)">Utils</a></span></span><span class='period'>.</span><span class='id identifier rubyid_popen_read'><span class='object_link'><a href="../Utils.html#popen_read-class_method" title="Utils.popen_read (method)">popen_read</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_curl_executable'>curl_executable</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--homebrew=print-path</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_response_follow_redirections-class_method">
  
    .<strong>curl_response_follow_redirections</strong>(responses, base_url)  &#x21d2; <tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Returns the final URL by following location headers in cURL responses.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>responses</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'>T</span>.untyped}&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>An array of hashes containing response
status information and headers from <code>#parse_curl_response</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>base_url</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The URL to use as a base.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The final absolute URL after redirections.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


561
562
563
564
565
566
567
568
569
570
571
572</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 561</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_response_follow_redirections'>curl_response_follow_redirections</span><span class='lparen'>(</span><span class='id identifier rubyid_responses'>responses</span><span class='comma'>,</span> <span class='id identifier rubyid_base_url'>base_url</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_responses'>responses</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_location'>location</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>location</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_base_url'>base_url</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_base_url'>base_url</span><span class='comma'>,</span> <span class='id identifier rubyid_location'>location</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_base_url'>base_url</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_response_last_location-class_method">
  
    .<strong>curl_response_last_location</strong>(responses, absolutize: false, base_url: nil)  &#x21d2; <tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Returns the URL from the last location header found in cURL responses,
if any.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>responses</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'>T</span>.untyped}&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>An array of hashes containing response
status information and headers from <code>#parse_curl_response</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>absolutize</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Whether to make the location URL absolute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>base_url</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The URL to use as a base for making the
<code>location</code> URL absolute.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The URL from the last-occurring <code>location</code> header
in the responses or <code>nil</code> (if no <code>location</code> headers found).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


536
537
538
539
540
541
542
543
544
545
546
547
548</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 536</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_response_last_location'>curl_response_last_location</span><span class='lparen'>(</span><span class='id identifier rubyid_responses'>responses</span><span class='comma'>,</span> <span class='label'>absolutize:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>base_url:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_responses'>responses</span><span class='period'>.</span><span class='id identifier rubyid_reverse_each'>reverse_each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_location'>location</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>location</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_absolute_url'>absolute_url</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_base_url'>base_url</span><span class='comma'>,</span> <span class='id identifier rubyid_location'>location</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='id identifier rubyid_absolutize'>absolutize</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_base_url'>base_url</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_absolute_url'>absolute_url</span> <span class='op'>||</span> <span class='id identifier rubyid_location'>location</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_supports_tls13?-class_method">
  
    .<strong>curl_supports_tls13?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


475
476
477
478
479
480</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 475</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_supports_tls13?'>curl_supports_tls13?</span>
  <span class='ivar'>@curl_supports_tls13</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../Hash.html" title="Hash (class)">Hash</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_quiet_system'>quiet_system</span><span class='lparen'>(</span><span class='id identifier rubyid_curl_executable'>curl_executable</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--tlsv1.3</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--head</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://brew.sh/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='ivar'>@curl_supports_tls13</span><span class='lbracket'>[</span><span class='id identifier rubyid_curl_path'>curl_path</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="curl_with_workarounds-class_method">
  
    .<strong>curl_with_workarounds</strong>(*args, secrets: nil, print_stdout: nil, print_stderr: nil, debug: nil, verbose: nil, env: {}, timeout: nil, use_homebrew_curl: false, **options)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>Timeout::Error</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 127</span>

<span class='kw'>def</span> <span class='id identifier rubyid_curl_with_workarounds'>curl_with_workarounds</span><span class='lparen'>(</span>
  <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span>
  <span class='label'>secrets:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>print_stdout:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>print_stderr:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>debug:</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>verbose:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>env:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>use_homebrew_curl:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>
<span class='rparen'>)</span>
  <span class='id identifier rubyid_end_time'>end_time</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='id identifier rubyid_timeout'>timeout</span> <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span>

  <span class='id identifier rubyid_command_options'>command_options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>secrets:</span><span class='comma'>,</span>
    <span class='label'>print_stdout:</span><span class='comma'>,</span>
    <span class='label'>print_stderr:</span><span class='comma'>,</span>
    <span class='label'>debug:</span><span class='comma'>,</span>
    <span class='label'>verbose:</span><span class='comma'>,</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_system_command'>system_command</span> <span class='id identifier rubyid_curl_executable'>curl_executable</span><span class='lparen'>(</span><span class='label'>use_homebrew_curl:</span><span class='rparen'>)</span><span class='comma'>,</span>
                          <span class='label'>args:</span>    <span class='id identifier rubyid_curl_args'>curl_args</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span><span class='comma'>,</span>
                          <span class='label'>env:</span><span class='comma'>,</span>
                          <span class='label'>timeout:</span> <span class='const'><span class='object_link'><a href="../Utils.html" title="Utils (module)">Utils</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Timer.html" title="Utils::Timer (module)">Timer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_remaining'><span class='object_link'><a href="Timer.html#remaining-class_method" title="Utils::Timer.remaining (method)">remaining</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_end_time'>end_time</span><span class='rparen'>)</span><span class='comma'>,</span>
                          <span class='op'>**</span><span class='id identifier rubyid_command_options'>command_options</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_result'>result</span> <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span> <span class='op'>||</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--http1.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_stderr'>stderr</span><span class='period'>.</span><span class='id identifier rubyid_lines'>lines</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span> <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span> <span class='op'>==</span> <span class='int'>28</span>

  <span class='comment'># Error in the HTTP2 framing layer
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_exit_status'>exit_status</span> <span class='op'>==</span> <span class='int'>16</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_curl_with_workarounds'>curl_with_workarounds</span><span class='lparen'>(</span>
      <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--http1.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>timeout:</span> <span class='const'><span class='object_link'><a href="../Utils.html" title="Utils (module)">Utils</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Timer.html" title="Utils::Timer (module)">Timer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_remaining'><span class='object_link'><a href="Timer.html#remaining-class_method" title="Utils::Timer.remaining (method)">remaining</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_end_time'>end_time</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_command_options'>command_options</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># This is a workaround for https://github.com/curl/curl/issues/1618.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_exit_status'>exit_status</span> <span class='op'>==</span> <span class='int'>56</span> <span class='comment'># Unexpected EOF
</span>    <span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='id identifier rubyid_curl_output'>curl_output</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-V</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_stdout'>stdout</span>

    <span class='comment'># If `curl` doesn&#39;t support HTTP2, the exception is unrelated to this bug.
</span>    <span class='kw'>return</span> <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='comment'># The bug is fixed in `curl` &gt;= 7.60.0.
</span>    <span class='id identifier rubyid_curl_version'>curl_version</span> <span class='op'>=</span> <span class='id identifier rubyid_out'>out</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>curl (\d+(\.\d+)+)</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_result'>result</span> <span class='kw'>if</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_curl_version'>curl_version</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>7.60.0</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_curl_with_workarounds'>curl_with_workarounds</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--http1.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_command_options'>command_options</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="http_status_ok?-class_method">
  
    .<strong>http_status_ok?</strong>(status)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


482
483
484</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 482</span>

<span class='kw'>def</span> <span class='id identifier rubyid_http_status_ok?'>http_status_ok?</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='int'>100</span><span class='op'>..</span><span class='int'>299</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_cover?'>cover?</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_curl_output-class_method">
  
    .<strong>parse_curl_output</strong>(output, max_iterations: 25)  &#x21d2; <tt><span class='object_link'><a href="../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'>T</span>.untyped}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Separates the output text from <code>curl</code> into an array of HTTP responses and
the final response body (i.e. content). Response hashes contain the
<code>:status_code</code>, <code>:status_text</code>, and <code>:headers</code>.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>output</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The output text from <code>curl</code> containing HTTP
responses, body content, or both.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>max_iterations</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>25</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The maximum number of iterations for the
<code>while</code> loop that parses HTTP response text. This should correspond to
the maximum number of requests in the output. If <code>curl</code>s <code>--max-redirs</code>
option is used, <code>max_iterations</code> should be <code>max-redirs + 1</code>, to
account for any final response after the redirections.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'>T</span>.untyped}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A hash containing an array of response hashes and the body
content, if found.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 499</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_curl_output'>parse_curl_output</span><span class='lparen'>(</span><span class='id identifier rubyid_output'>output</span><span class='comma'>,</span> <span class='label'>max_iterations:</span> <span class='int'>25</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_responses'>responses</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_iterations'>iterations</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_lstrip'>lstrip</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\AHTTP/[\d.]+ \d+</span><span class='regexp_end'>}</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='const'>HTTP_RESPONSE_BODY_SEPARATOR</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_iterations'>iterations</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Too many redirects (max = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_iterations'>max_iterations</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_iterations'>iterations</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_max_iterations'>max_iterations</span>

    <span class='id identifier rubyid_response_text'>response_text</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_partition'>partition</span><span class='lparen'>(</span><span class='const'>HTTP_RESPONSE_BODY_SEPARATOR</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_lstrip'>lstrip</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_response_text'>response_text</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_response_text'>response_text</span><span class='period'>.</span><span class='id identifier rubyid_chomp!'>chomp!</span>
    <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_curl_response'>parse_curl_response</span><span class='lparen'>(</span><span class='id identifier rubyid_response_text'>response_text</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_responses'>responses</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_response'>response</span> <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='kw'>end</span>

  <span class='lbrace'>{</span> <span class='label'>responses:</span><span class='comma'>,</span> <span class='label'>body:</span> <span class='id identifier rubyid_output'>output</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="url_protected_by_cloudflare?-class_method">
  
    .<strong>url_protected_by_cloudflare?</strong>(response)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Check if a URL is protected by CloudFlare (e.g. badlion.net and jaxx.io).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>response</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'>T</span>.untyped}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A response hash from <code>#parse_curl_response</code>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether a response contains headers indicating that
the URL is protected by Cloudflare.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


252
253
254
255
256
257</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 252</span>

<span class='kw'>def</span> <span class='id identifier rubyid_url_protected_by_cloudflare?'>url_protected_by_cloudflare?</span><span class='lparen'>(</span><span class='id identifier rubyid_response'>response</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='lbracket'>[</span><span class='int'>403</span><span class='comma'>,</span> <span class='int'>503</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>

  <span class='lbracket'>[</span><span class='op'>*</span><span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>server</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^cloudflare</span><span class='regexp_end'>/i</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="url_protected_by_incapsula?-class_method">
  
    .<strong>url_protected_by_incapsula?</strong>(response)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Check if a URL is protected by Incapsula (e.g. corsair.com).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>response</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Hash.html" title="Hash (class)">Hash</a></span>{<span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'>T</span>.untyped}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A response hash from <code>#parse_curl_response</code>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether a response contains headers indicating that
the URL is protected by Incapsula.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


264
265
266
267
268
269
270</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'utils/curl.rb', line 264</span>

<span class='kw'>def</span> <span class='id identifier rubyid_url_protected_by_incapsula?'>url_protected_by_incapsula?</span><span class='lparen'>(</span><span class='id identifier rubyid_response'>response</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:status_code</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>!=</span> <span class='int'>403</span>

  <span class='id identifier rubyid_set_cookie_header'>set_cookie_header</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>set-cookie</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_set_cookie_header'>set_cookie_header</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cookie'>cookie</span><span class='op'>|</span> <span class='id identifier rubyid_cookie'>cookie</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(visid_incap|incap_ses)_</span><span class='regexp_end'>/i</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>