<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Homebrew::Livecheck::Strategy
  
    &mdash; Homebrew Ruby API
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Homebrew::Livecheck::Strategy";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Livecheck.html" title="Homebrew::Livecheck (module)">Livecheck</a></span></span>
     &raquo; 
    <span class="title">Strategy</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Homebrew::Livecheck::Strategy
  
  
  <span class="private note title">Private</span>
</h1>
<div class="box_info">
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>T::Sig</dd>
  </dl>
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>livecheck/strategy.rb<span class="defines">,<br />
  livecheck/strategy/git.rb,<br /> livecheck/strategy/gnu.rb,<br /> livecheck/strategy/npm.rb,<br /> livecheck/strategy/cpan.rb,<br /> livecheck/strategy/pypi.rb,<br /> livecheck/strategy/xorg.rb,<br /> livecheck/strategy/gnome.rb,<br /> livecheck/strategy/apache.rb,<br /> livecheck/strategy/hackage.rb,<br /> livecheck/strategy/sparkle.rb,<br /> livecheck/strategy/bitbucket.rb,<br /> livecheck/strategy/launchpad.rb,<br /> livecheck/strategy/page_match.rb,<br /> livecheck/strategy/sourceforge.rb,<br /> livecheck/strategy/header_match.rb,<br /> livecheck/strategy/extract_plist.rb,<br /> livecheck/strategy/github_latest.rb,<br /> livecheck/strategy/electron_builder.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This module is part of a private API.</strong>
  This module may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this module if possible, as it may be removed or changed without warning.
</p>
<p>The <code>Livecheck::Strategy</code> module contains the various strategies as well
as some general-purpose methods for working with them. Within the context
of the <code>brew livecheck</code> command, strategies are established procedures
for finding new software versions at a given source.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Strategy/Apache.html" title="Homebrew::Livecheck::Strategy::Apache (class)">Apache</a></span>, <span class='object_link'><a href="Strategy/Bitbucket.html" title="Homebrew::Livecheck::Strategy::Bitbucket (class)">Bitbucket</a></span>, <span class='object_link'><a href="Strategy/Cpan.html" title="Homebrew::Livecheck::Strategy::Cpan (class)">Cpan</a></span>, <span class='object_link'><a href="Strategy/ElectronBuilder.html" title="Homebrew::Livecheck::Strategy::ElectronBuilder (class)">ElectronBuilder</a></span>, <span class='object_link'><a href="Strategy/ExtractPlist.html" title="Homebrew::Livecheck::Strategy::ExtractPlist (class)">ExtractPlist</a></span>, <span class='object_link'><a href="Strategy/Git.html" title="Homebrew::Livecheck::Strategy::Git (class)">Git</a></span>, <span class='object_link'><a href="Strategy/GithubLatest.html" title="Homebrew::Livecheck::Strategy::GithubLatest (class)">GithubLatest</a></span>, <span class='object_link'><a href="Strategy/Gnome.html" title="Homebrew::Livecheck::Strategy::Gnome (class)">Gnome</a></span>, <span class='object_link'><a href="Strategy/Gnu.html" title="Homebrew::Livecheck::Strategy::Gnu (class)">Gnu</a></span>, <span class='object_link'><a href="Strategy/Hackage.html" title="Homebrew::Livecheck::Strategy::Hackage (class)">Hackage</a></span>, <span class='object_link'><a href="Strategy/HeaderMatch.html" title="Homebrew::Livecheck::Strategy::HeaderMatch (class)">HeaderMatch</a></span>, <span class='object_link'><a href="Strategy/Launchpad.html" title="Homebrew::Livecheck::Strategy::Launchpad (class)">Launchpad</a></span>, <span class='object_link'><a href="Strategy/Npm.html" title="Homebrew::Livecheck::Strategy::Npm (class)">Npm</a></span>, <span class='object_link'><a href="Strategy/PageMatch.html" title="Homebrew::Livecheck::Strategy::PageMatch (class)">PageMatch</a></span>, <span class='object_link'><a href="Strategy/Pypi.html" title="Homebrew::Livecheck::Strategy::Pypi (class)">Pypi</a></span>, <span class='object_link'><a href="Strategy/Sourceforge.html" title="Homebrew::Livecheck::Strategy::Sourceforge (class)">Sourceforge</a></span>, <span class='object_link'><a href="Strategy/Sparkle.html" title="Homebrew::Livecheck::Strategy::Sparkle (class)">Sparkle</a></span>, <span class='object_link'><a href="Strategy/Xorg.html" title="Homebrew::Livecheck::Strategy::Xorg (class)">Xorg</a></span>
    
  
</p>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#from_symbol-class_method" title="from_symbol (class method)">.<strong>from_symbol</strong>(symbol)  &#x21d2; Strategy<sup>?</sup> </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Returns the <span class='object_link'><a href="" title="Homebrew::Livecheck::Strategy (module)">Strategy</a></span> that corresponds to the provided <code>Symbol</code> (or <code>nil</code> if there is no matching <span class='object_link'><a href="" title="Homebrew::Livecheck::Strategy (module)">Strategy</a></span>).</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#from_url-class_method" title="from_url (class method)">.<strong>from_url</strong>(url, livecheck_strategy: nil, url_provided: nil, regex_provided: nil, block_provided: nil)  &#x21d2; Array </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Returns an array of strategies that apply to the provided URL.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#page_content-class_method" title="page_content (class method)">.<strong>page_content</strong>(url)  &#x21d2; Hash{Symbol =&gt; T.untyped} </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Fetches the content at the URL and returns a hash containing the content and, if there are any redirections, the final URL.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#page_headers-class_method" title="page_headers (class method)">.<strong>page_headers</strong>(url)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="from_symbol-class_method">
  
    .<strong>from_symbol</strong>(symbol)  &#x21d2; <tt><span class='object_link'><a href="" title="Homebrew::Livecheck::Strategy (module)">Strategy</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Returns the <span class='object_link'><a href="" title="Homebrew::Livecheck::Strategy (module)">Homebrew::Livecheck::Strategy</a></span> that corresponds to the provided <code>Symbol</code> (or
<code>nil</code> if there is no matching <span class='object_link'><a href="" title="Homebrew::Livecheck::Strategy (module)">Homebrew::Livecheck::Strategy</a></span>).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>symbol</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the strategy name in snake case as a <code>Symbol</code>
(e.g. <code>:page_match</code>)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Homebrew::Livecheck::Strategy (module)">Strategy</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'livecheck/strategy.rb', line 111</span>

<span class='kw'>def</span> <span class='id identifier rubyid_from_symbol'>from_symbol</span><span class='lparen'>(</span><span class='id identifier rubyid_symbol'>symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_strategies'>strategies</span><span class='lbracket'>[</span><span class='id identifier rubyid_symbol'>symbol</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="from_url-class_method">
  
    .<strong>from_url</strong>(url, livecheck_strategy: nil, url_provided: nil, regex_provided: nil, block_provided: nil)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Returns an array of strategies that apply to the provided URL.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>url</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the URL to check for matching strategies</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>livecheck_strategy</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>a <span class='object_link'><a href="" title="Homebrew::Livecheck::Strategy (module)">Homebrew::Livecheck::Strategy</a></span> symbol from the
<code>livecheck</code> block</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>regex_provided</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>whether a regex is provided in the
<code>livecheck</code> block</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'livecheck/strategy.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_from_url'>from_url</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='label'>livecheck_strategy:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>url_provided:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>regex_provided:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>block_provided:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_usable_strategies'>usable_strategies</span> <span class='op'>=</span> <span class='id identifier rubyid_strategies'>strategies</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_strategy'>strategy</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_strategy'>strategy</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="Strategy/PageMatch.html" title="Homebrew::Livecheck::Strategy::PageMatch (class)">PageMatch</a></span></span>
      <span class='comment'># Only treat the `PageMatch` strategy as usable if a regex is
</span>      <span class='comment'># present in the `livecheck` block
</span>      <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_regex_provided'>regex_provided</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_block_provided'>block_provided</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_strategy'>strategy</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='symbol'>:PRIORITY</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
          <span class='op'>!</span><span class='id identifier rubyid_strategy'>strategy</span><span class='op'>::</span><span class='const'>PRIORITY</span><span class='period'>.</span><span class='id identifier rubyid_positive?'>positive?</span> <span class='op'>&amp;&amp;</span>
          <span class='id identifier rubyid_from_symbol'>from_symbol</span><span class='lparen'>(</span><span class='id identifier rubyid_livecheck_strategy'>livecheck_strategy</span><span class='rparen'>)</span> <span class='op'>!=</span> <span class='id identifier rubyid_strategy'>strategy</span>
      <span class='comment'># Ignore strategies with a priority of 0 or lower, unless the
</span>      <span class='comment'># strategy is specified in the `livecheck` block
</span>      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_strategy'>strategy</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:match?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_strategy'>strategy</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Sort usable strategies in descending order by priority, using the
</span>  <span class='comment'># DEFAULT_PRIORITY when a strategy doesn&#39;t contain a PRIORITY constant
</span>  <span class='id identifier rubyid_usable_strategies'>usable_strategies</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_strategy'>strategy</span><span class='op'>|</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_strategy'>strategy</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='symbol'>:PRIORITY</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='op'>-</span><span class='id identifier rubyid_strategy'>strategy</span><span class='op'>::</span><span class='const'>PRIORITY</span> <span class='op'>:</span> <span class='op'>-</span><span class='const'>DEFAULT_PRIORITY</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="page_content-class_method">
  
    .<strong>page_content</strong>(url)  &#x21d2; <tt>Hash{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; T.untyped}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Fetches the content at the URL and returns a hash containing the
content and, if there are any redirections, the final URL.
If <code>curl</code> encounters an error, the hash will contain a <code>:messages</code>
array with the error message instead.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>url</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the URL of the content to check</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{<span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; T.untyped}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'livecheck/strategy.rb', line 179</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_page_content'>page_content</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_original_url'>original_url</span> <span class='op'>=</span> <span class='id identifier rubyid_url'>url</span>

  <span class='id identifier rubyid_stderr'>stderr</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='lbracket'>[</span><span class='symbol'>:default</span><span class='comma'>,</span> <span class='symbol'>:browser</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_agent'>user_agent</span><span class='op'>|</span>
    <span class='id identifier rubyid_stdout'>stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_stderr'>stderr</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='id identifier rubyid_curl_with_workarounds'><span class='object_link'><a href="../../Utils/Curl.html#curl_with_workarounds-class_method" title="Utils::Curl.curl_with_workarounds (method)">curl_with_workarounds</a></span></span><span class='lparen'>(</span>
      <span class='op'>*</span><span class='const'>PAGE_CONTENT_CURL_ARGS</span><span class='comma'>,</span> <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span>
      <span class='op'>**</span><span class='const'>DEFAULT_CURL_OPTIONS</span><span class='comma'>,</span>
      <span class='label'>user_agent:</span> <span class='id identifier rubyid_user_agent'>user_agent</span>
    <span class='rparen'>)</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>

    <span class='comment'># stdout contains the header information followed by the page content.
</span>    <span class='comment'># We use #scrub here to avoid &quot;invalid byte sequence in UTF-8&quot; errors.
</span>    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='period'>.</span><span class='id identifier rubyid_scrub'>scrub</span>

    <span class='comment'># Separate the head(s)/body and identify the final URL (after any
</span>    <span class='comment'># redirections)
</span>    <span class='id identifier rubyid_max_iterations'>max_iterations</span> <span class='op'>=</span> <span class='int'>5</span>
    <span class='id identifier rubyid_iterations'>iterations</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_lstrip'>lstrip</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\AHTTP/[\d.]+ \d+</span><span class='regexp_end'>}</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='const'>HTTP_HEAD_BODY_SEPARATOR</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_iterations'>iterations</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Too many redirects (max = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_iterations'>max_iterations</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_iterations'>iterations</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_max_iterations'>max_iterations</span>

      <span class='id identifier rubyid_head_text'>head_text</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_partition'>partition</span><span class='lparen'>(</span><span class='const'>HTTP_HEAD_BODY_SEPARATOR</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_lstrip'>lstrip</span>

      <span class='id identifier rubyid_location'>location</span> <span class='op'>=</span> <span class='id identifier rubyid_head_text'>head_text</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^Location:\s*(.*)$</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

      <span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_chomp!'>chomp!</span>
      <span class='comment'># Convert a relative redirect URL to an absolute URL
</span>      <span class='id identifier rubyid_location'>location</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='id identifier rubyid_location'>location</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Strategy/PageMatch.html" title="Homebrew::Livecheck::Strategy::PageMatch (class)">PageMatch</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Strategy/PageMatch.html#URL_MATCH_REGEX-constant" title="Homebrew::Livecheck::Strategy::PageMatch::URL_MATCH_REGEX (constant)">URL_MATCH_REGEX</a></span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_final_url'>final_url</span> <span class='op'>=</span> <span class='id identifier rubyid_location'>location</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>content:</span> <span class='id identifier rubyid_output'>output</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:final_url</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_final_url'>final_url</span> <span class='kw'>if</span> <span class='id identifier rubyid_final_url'>final_url</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_final_url'>final_url</span> <span class='op'>!=</span> <span class='id identifier rubyid_original_url'>original_url</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_data'>data</span>
  <span class='kw'>end</span>

  <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(?&lt;error_msg&gt;curl: \(\d+\) .+)</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_stderr'>stderr</span>
  <span class='lbrace'>{</span>
    <span class='label'>messages:</span> <span class='lbracket'>[</span><span class='id identifier rubyid_error_msg'>error_msg</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cURL failed without an error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="page_headers-class_method">
  
    .<strong>page_headers</strong>(url)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>



  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'livecheck/strategy.rb', line 147</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_page_headers'>page_headers</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_headers'>headers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='lbracket'>[</span><span class='symbol'>:default</span><span class='comma'>,</span> <span class='symbol'>:browser</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_agent'>user_agent</span><span class='op'>|</span>
    <span class='id identifier rubyid_stdout'>stdout</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='id identifier rubyid_curl_with_workarounds'><span class='object_link'><a href="../../Utils/Curl.html#curl_with_workarounds-class_method" title="Utils::Curl.curl_with_workarounds (method)">curl_with_workarounds</a></span></span><span class='lparen'>(</span>
      <span class='op'>*</span><span class='const'>PAGE_HEADERS_CURL_ARGS</span><span class='comma'>,</span> <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span>
      <span class='op'>**</span><span class='const'>DEFAULT_CURL_OPTIONS</span><span class='comma'>,</span>
      <span class='label'>user_agent:</span> <span class='id identifier rubyid_user_agent'>user_agent</span>
    <span class='rparen'>)</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\AHTTP.*\r$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_stdout'>stdout</span> <span class='op'>=</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n\r\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_headers'>headers</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_h'>h</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
                  <span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_header'>header</span><span class='op'>|</span> <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:\s*</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
                  <span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span><span class='period'>.</span><span class='id identifier rubyid_transform_keys'>transform_keys</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:downcase</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_headers'>headers</span> <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_headers'>headers</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>