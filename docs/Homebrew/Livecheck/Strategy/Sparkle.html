<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Homebrew::Livecheck::Strategy::Sparkle
  
    &mdash; Homebrew Ruby API
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Homebrew::Livecheck::Strategy::Sparkle";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Livecheck.html" title="Homebrew::Livecheck (module)">Livecheck</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Strategy.html" title="Homebrew::Livecheck::Strategy (module)">Strategy</a></span></span>
     &raquo; 
    <span class="title">Sparkle</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Homebrew::Livecheck::Strategy::Sparkle
  
  
  <span class="private note title">Private</span>
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Homebrew::Livecheck::Strategy::Sparkle</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>livecheck/strategy/sparkle.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This class is part of a private API.</strong>
  This class may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this class if possible, as it may be removed or changed without warning.
</p>
<p>The <span class='object_link'><a href="" title="Homebrew::Livecheck::Strategy::Sparkle (class)">Sparkle</a></span> strategy fetches content at a URL and parses it as a
Sparkle appcast in XML format.</p>

<p>This strategy is not applied automatically and itâ€™s necessary to use
<code>strategy :sparkle</code> in a <code>livecheck</code> block to apply it.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Sparkle/Item.html" title="Homebrew::Livecheck::Strategy::Sparkle::Item (class)">Item</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="PRIORITY-constant" class="">PRIORITY =
          <div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This constant is part of a private API.</strong>
  This constant may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this constant if possible, as it may be removed or changed without warning.
</p>
<p>A priority of zero causes livecheck to skip the strategy. We do this
for <span class='object_link'><a href="" title="Homebrew::Livecheck::Strategy::Sparkle (class)">Homebrew::Livecheck::Strategy::Sparkle</a></span> so we can selectively apply it when appropriate.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0</span></pre></dd>
      
        <dt id="URL_MATCH_REGEX-constant" class="">URL_MATCH_REGEX =
          <div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This constant is part of a private API.</strong>
  This constant may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this constant if possible, as it may be removed or changed without warning.
</p>
<p>The <code>Regexp</code> used to determine if the strategy applies to the URL.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^https?://</span><span class='regexp_end'>}i</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#find_versions-class_method" title="find_versions (class method)">.<strong>find_versions</strong>(url:, regex: nil, **_unused, &amp;block)  &#x21d2; Hash{Symbol =&gt; T.untyped} </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Checks the content at the URL for new versions.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#items_from_content-class_method" title="items_from_content (class method)">.<strong>items_from_content</strong>(content)  &#x21d2; Array&lt;Item&gt; </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Identifies version information from a Sparkle appcast.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#match%3F-class_method" title="match? (class method)">.<strong>match?</strong>(url)  &#x21d2; Boolean </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Whether the strategy can be applied to the provided URL.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#versions_from_content-class_method" title="versions_from_content (class method)">.<strong>versions_from_content</strong>(content, regex = nil, &amp;block)  &#x21d2; Array&lt;String&gt; </a>
    
    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>
  
    <span class="summary_desc"><div class='inline'><p>Uses <code>#items_from_content</code> to identify versions from the Sparkle appcast content or, if a block is provided, passes the content to the block to handle matching.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="find_versions-class_method">
  
    .<strong>find_versions</strong>(url:, regex: nil, **_unused, &amp;block)  &#x21d2; <tt>Hash{<span class='object_link'><a href="../../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'>T</span>.untyped}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Checks the content at the URL for new versions.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>url</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the URL of the content to check</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>regex</span>
      
      
        <span class='type'>(<tt>Regexp</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>a regex for use in a strategy block</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>_unused</span>
      
      
        <span class='type'>(<tt>Hash{<span class='object_link'><a href="../../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'>T</span>.untyped}</tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>block</span>
      
      
        <span class='type'>(<tt><span class='object_link'>T</span>.untyped</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{<span class='object_link'><a href="../../../Symbol.html" title="Symbol (class)">Symbol</a></span> =&gt; <span class='object_link'>T</span>.untyped}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'livecheck/strategy/sparkle.rb', line 204</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_versions'>find_versions</span><span class='lparen'>(</span><span class='label'>url:</span><span class='comma'>,</span> <span class='label'>regex:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid__unused'>_unused</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_regex'>regex</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="../../../Utils.html" title="Utils (module)">Utils</a></span></span><span class='period'>.</span><span class='id identifier rubyid_demodulize'><span class='object_link'><a href="../../../Utils.html#demodulize-class_method" title="Utils.demodulize (method)">demodulize</a></span></span><span class='lparen'>(</span><span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_must'>must</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> only supports a regex when using a `strategy` block</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_match_data'>match_data</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>matches:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>regex:</span> <span class='id identifier rubyid_regex'>regex</span><span class='comma'>,</span> <span class='label'>url:</span> <span class='id identifier rubyid_url'>url</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_match_data'>match_data</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Strategy.html" title="Homebrew::Livecheck::Strategy (module)">Strategy</a></span></span><span class='period'>.</span><span class='id identifier rubyid_page_content'><span class='object_link'><a href="../Strategy.html#page_content-class_method" title="Homebrew::Livecheck::Strategy.page_content (method)">page_content</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='id identifier rubyid_match_data'>match_data</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:content</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_versions_from_content'>versions_from_content</span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='comma'>,</span> <span class='id identifier rubyid_regex'>regex</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_version_text'>version_text</span><span class='op'>|</span>
    <span class='id identifier rubyid_match_data'>match_data</span><span class='lbracket'>[</span><span class='symbol'>:matches</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_version_text'>version_text</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Version.html" title="Version (class)">Version</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../../Version.html#initialize-instance_method" title="Version#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_version_text'>version_text</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_match_data'>match_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="items_from_content-class_method">
  
    .<strong>items_from_content</strong>(content)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Sparkle/Item.html" title="Homebrew::Livecheck::Strategy::Sparkle::Item (class)">Item</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Identifies version information from a Sparkle appcast.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>content</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the text of the Sparkle appcast</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Sparkle/Item.html" title="Homebrew::Livecheck::Strategy::Sparkle::Item (class)">Item</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'livecheck/strategy/sparkle.rb', line 68</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_items_from_content'>items_from_content</span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rexml/document</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_parsing_tries'>parsing_tries</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_xml'>xml</span> <span class='op'>=</span> <span class='kw'>begin</span>
    <span class='const'>REXML</span><span class='op'>::</span><span class='const'>Document</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>REXML</span><span class='op'>::</span><span class='const'>UndefinedNamespaceException</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_undefined_prefix'>undefined_prefix</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>Undefined prefix ([^ ]+) found</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='kw'>if</span> <span class='id identifier rubyid_undefined_prefix'>undefined_prefix</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='comment'># Only retry parsing once after removing prefix from content
</span>    <span class='id identifier rubyid_parsing_tries'>parsing_tries</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='kw'>if</span> <span class='id identifier rubyid_parsing_tries'>parsing_tries</span> <span class='op'>&gt;</span> <span class='int'>1</span>

    <span class='comment'># When an XML document contains a prefix without a corresponding
</span>    <span class='comment'># namespace, it&#39;s necessary to remove the prefix from the content
</span>    <span class='comment'># to be able to successfully parse it using REXML
</span>    <span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='id identifier rubyid_content'>content</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>(&lt;/?| )</span><span class='embexpr_beg'>#{</span><span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_escape'>escape</span><span class='lparen'>(</span><span class='id identifier rubyid_undefined_prefix'>undefined_prefix</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='regexp_end'>}</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>retry</span>
  <span class='kw'>end</span>

  <span class='comment'># Remove prefixes, so we can reliably identify elements and attributes
</span>  <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='op'>&amp;.</span><span class='id identifier rubyid_each_recursive'>each_recursive</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_node'>node</span><span class='op'>|</span>
    <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_prefix'>prefix</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_each_attribute'>each_attribute</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attribute'>attribute</span><span class='op'>|</span>
      <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_prefix'>prefix</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_xml'>xml</span><span class='period'>.</span><span class='id identifier rubyid_get_elements'>get_elements</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//rss//channel//item</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
    <span class='id identifier rubyid_enclosure'>enclosure</span> <span class='op'>=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>enclosure</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_enclosure'>enclosure</span>
      <span class='id identifier rubyid_url'>url</span> <span class='op'>=</span> <span class='id identifier rubyid_enclosure'>enclosure</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>url</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_short_version'>short_version</span> <span class='op'>=</span> <span class='id identifier rubyid_enclosure'>enclosure</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>shortVersionString</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='id identifier rubyid_enclosure'>enclosure</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>version</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_os'>os</span> <span class='op'>=</span> <span class='id identifier rubyid_enclosure'>enclosure</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>os</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_channel'>channel</span> <span class='op'>=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>channel</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_text'>text</span>
    <span class='id identifier rubyid_url'>url</span> <span class='op'>||=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>link</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_text'>text</span>
    <span class='id identifier rubyid_short_version'>short_version</span> <span class='op'>||=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>shortVersionString</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_text'>text</span><span class='op'>&amp;.</span><span class='id identifier rubyid_strip'>strip</span>
    <span class='id identifier rubyid_version'>version</span> <span class='op'>||=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>version</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_text'>text</span><span class='op'>&amp;.</span><span class='id identifier rubyid_strip'>strip</span>

    <span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>title</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_text'>text</span><span class='op'>&amp;.</span><span class='id identifier rubyid_strip'>strip</span>
    <span class='id identifier rubyid_pub_date'>pub_date</span> <span class='op'>=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pubDate</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_text'>text</span><span class='op'>&amp;.</span><span class='id identifier rubyid_strip'>strip</span><span class='op'>&amp;.</span><span class='id identifier rubyid_presence'>presence</span><span class='op'>&amp;.</span><span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_date_string'>date_string</span><span class='op'>|</span>
      <span class='const'><span class='object_link'><a href="../../../Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_date_string'>date_string</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>ArgumentError</span>
      <span class='comment'># Omit unparseable strings (e.g. non-English dates)
</span>      <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='id identifier rubyid_title'>title</span><span class='op'>&amp;.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(\d+(?:\.\d+)*)\s*(\([^)]+\))?\Z</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_short_version'>short_version</span> <span class='op'>||=</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_version'>version</span> <span class='op'>||=</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_bundle_version'>bundle_version</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../BundleVersion.html" title="Homebrew::BundleVersion (class)">BundleVersion</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../BundleVersion.html#initialize-instance_method" title="Homebrew::BundleVersion#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_short_version'>short_version</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_short_version'>short_version</span> <span class='op'>||</span> <span class='id identifier rubyid_version'>version</span>

    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_os'>os</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_os'>os</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>osx</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id identifier rubyid_os'>os</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>macos</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_minimum_system_version'>minimum_system_version</span> <span class='op'>=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_elements'>elements</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>minimumSystemVersion</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_text'>text</span><span class='op'>&amp;.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A\D+|\D+\z</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_macos_minimum_system_version'>macos_minimum_system_version</span> <span class='op'>=</span> <span class='kw'>begin</span>
        <span class='const'><span class='object_link'><a href="../../../OS.html" title="OS (module)">OS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../OS/Mac.html" title="OS::Mac (module)">Mac</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../OS/Mac/Version.html" title="OS::Mac::Version (class)">Version</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../../OS/Mac/Version.html#initialize-instance_method" title="OS::Mac::Version#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_minimum_system_version'>minimum_system_version</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip_patch'>strip_patch</span>
      <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="../../../MacOSVersionError.html" title="MacOSVersionError (class)">MacOSVersionError</a></span></span>
        <span class='kw'>nil</span>
      <span class='kw'>end</span>

      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_macos_minimum_system_version'>macos_minimum_system_version</span><span class='op'>&amp;.</span><span class='id identifier rubyid_prerelease?'>prerelease?</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>title:</span>          <span class='id identifier rubyid_title'>title</span><span class='comma'>,</span>
      <span class='label'>channel:</span>        <span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span>
      <span class='label'>pub_date:</span>       <span class='id identifier rubyid_pub_date'>pub_date</span><span class='comma'>,</span>
      <span class='label'>url:</span>            <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span>
      <span class='label'>bundle_version:</span> <span class='id identifier rubyid_bundle_version'>bundle_version</span><span class='comma'>,</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='comment'># Set a default `pub_date` (for sorting) if one isn&#39;t provided
</span>    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:pub_date</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="../../../Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>

    <span class='const'><span class='object_link'><a href="Sparkle/Item.html" title="Homebrew::Livecheck::Strategy::Sparkle::Item (class)">Item</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="match?-class_method">
  
    .<strong>match?</strong>(url)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Whether the strategy can be applied to the provided URL.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>url</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the URL to match against</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'livecheck/strategy/sparkle.rb', line 31</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="#URL_MATCH_REGEX-constant" title="Homebrew::Livecheck::Strategy::Sparkle::URL_MATCH_REGEX (constant)">URL_MATCH_REGEX</a></span></span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="versions_from_content-class_method">
  
    .<strong>versions_from_content</strong>(content, regex = nil, &amp;block)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  This method may only be used in the <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> repository.
  Third parties should avoid using this method if possible, as it may be removed or changed without warning.
</p>
<p>Uses <code>#items_from_content</code> to identify versions from the Sparkle
appcast content or, if a block is provided, passes the content to
the block to handle matching.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>content</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the content to check</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>regex</span>
      
      
        <span class='type'>(<tt>Regexp</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>a regex for use in a strategy block</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>block</span>
      
      
        <span class='type'>(<tt><span class='object_link'>T</span>.untyped</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'livecheck/strategy/sparkle.rb', line 169</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_versions_from_content'>versions_from_content</span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='comma'>,</span> <span class='id identifier rubyid_regex'>regex</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_items'>items</span> <span class='op'>=</span> <span class='id identifier rubyid_items_from_content'>items_from_content</span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_pub_date'>pub_date</span><span class='comma'>,</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_bundle_version'>bundle_version</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

  <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='id identifier rubyid_items'>items</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
    <span class='id identifier rubyid_block_return_value'>block_return_value</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_parameters'>parameters</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='lbracket'>[</span><span class='symbol'>:opt</span><span class='comma'>,</span> <span class='symbol'>:item</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:rest</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:req</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_regex'>regex</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>?</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> <span class='id identifier rubyid_regex'>regex</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='lbracket'>[</span><span class='symbol'>:opt</span><span class='comma'>,</span> <span class='symbol'>:items</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_regex'>regex</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>?</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='id identifier rubyid_regex'>regex</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_items'>items</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>First argument of Sparkle `strategy` block must be `item` or `items`</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="../Strategy.html" title="Homebrew::Livecheck::Strategy (module)">Strategy</a></span></span><span class='period'>.</span><span class='id identifier rubyid_handle_block_return'><span class='object_link'><a href="../Strategy.html#handle_block_return-class_method" title="Homebrew::Livecheck::Strategy.handle_block_return (method)">handle_block_return</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_block_return_value'>block_return_value</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='const'>T</span><span class='period'>.</span><span class='id identifier rubyid_must'>must</span><span class='lparen'>(</span><span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_bundle_version'>bundle_version</span><span class='op'>&amp;.</span><span class='id identifier rubyid_nice_version'>nice_version</span>
  <span class='id identifier rubyid_version'>version</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='id identifier rubyid_version'>version</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>