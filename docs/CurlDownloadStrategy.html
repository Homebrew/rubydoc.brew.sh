<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: CurlDownloadStrategy
  
    &mdash; Homebrew Ruby API
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "CurlDownloadStrategy";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (C)</a> &raquo;
    
    
    <span class="title">CurlDownloadStrategy</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: CurlDownloadStrategy
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="AbstractFileDownloadStrategy.html" title="AbstractFileDownloadStrategy (class)">AbstractFileDownloadStrategy</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next"><span class='object_link'><a href="AbstractDownloadStrategy.html" title="AbstractDownloadStrategy (class)">AbstractDownloadStrategy</a></span></li>
          
            <li class="next"><span class='object_link'><a href="AbstractFileDownloadStrategy.html" title="AbstractFileDownloadStrategy (class)">AbstractFileDownloadStrategy</a></span></li>
          
            <li class="next">CurlDownloadStrategy</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="Utils/Curl.html" title="Utils::Curl (module)">Utils::Curl</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>download_strategy.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Strategy for downloading files using <code>curl</code>.</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="CurlApacheMirrorDownloadStrategy.html" title="CurlApacheMirrorDownloadStrategy (class)">CurlApacheMirrorDownloadStrategy</a></span>, <span class='object_link'><a href="CurlGitHubPackagesDownloadStrategy.html" title="CurlGitHubPackagesDownloadStrategy (class)">CurlGitHubPackagesDownloadStrategy</a></span>, <span class='object_link'><a href="CurlPostDownloadStrategy.html" title="CurlPostDownloadStrategy (class)">CurlPostDownloadStrategy</a></span>, <span class='object_link'><a href="Homebrew/API/DownloadStrategy.html" title="Homebrew::API::DownloadStrategy (class)">Homebrew::API::DownloadStrategy</a></span>, <span class='object_link'><a href="HomebrewCurlDownloadStrategy.html" title="HomebrewCurlDownloadStrategy (class)">HomebrewCurlDownloadStrategy</a></span>, <span class='object_link'><a href="NoUnzipCurlDownloadStrategy.html" title="NoUnzipCurlDownloadStrategy (class)">NoUnzipCurlDownloadStrategy</a></span></p>
</div>




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      
<li class="public ">
  <span class="summary_signature">
    
      <a href="#mirrors-instance_method" title="#mirrors (instance method)">#<strong>mirrors</strong>  &#x21d2; Object </a>
    
    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="AbstractDownloadStrategy.html" title="AbstractDownloadStrategy (class)">AbstractDownloadStrategy</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="AbstractDownloadStrategy.html#cache-instance_method" title="AbstractDownloadStrategy#cache (method)">#cache</a></span>, <span class='object_link'><a href="AbstractDownloadStrategy.html#cached_location-instance_method" title="AbstractDownloadStrategy#cached_location (method)">#cached_location</a></span>, <span class='object_link'><a href="AbstractDownloadStrategy.html#source_modified_time-instance_method" title="AbstractDownloadStrategy#source_modified_time (method)">#source_modified_time</a></span>, <span class='object_link'><a href="AbstractDownloadStrategy.html#url-instance_method" title="AbstractDownloadStrategy#url (method)">#url</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_cache-instance_method" title="#clear_cache (instance method)">#<strong>clear_cache</strong>  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch-instance_method" title="#fetch (instance method)">#<strong>fetch</strong>(timeout: nil)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  
  
    <span class="summary_desc"><div class='inline'><p>Download and cache the file at <span class='object_link'><a href="AbstractFileDownloadStrategy.html#cached_location-instance_method" title="AbstractFileDownloadStrategy#cached_location (method)">AbstractFileDownloadStrategy#cached_location</a></span>.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(url, name, version, **meta)  &#x21d2; CurlDownloadStrategy </a>
    
    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  
  
    <span class="summary_desc"><div class='inline'><p>A new instance of CurlDownloadStrategy.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#resolved_time_file_size-instance_method" title="#resolved_time_file_size (instance method)">#<strong>resolved_time_file_size</strong>(timeout: nil)  &#x21d2; Object </a>
    
    
  </span>
  
  
  
  
  
  
  
  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Utils/Curl.html" title="Utils::Curl (module)">Utils::Curl</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Utils/Curl.html#clear_path_cache-class_method" title="Utils::Curl.clear_path_cache (method)">clear_path_cache</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl-class_method" title="Utils::Curl.curl (method)">curl</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_args-class_method" title="Utils::Curl.curl_args (method)">curl_args</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_check_http_content-class_method" title="Utils::Curl.curl_check_http_content (method)">curl_check_http_content</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_download-class_method" title="Utils::Curl.curl_download (method)">curl_download</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_executable-class_method" title="Utils::Curl.curl_executable (method)">curl_executable</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_headers-class_method" title="Utils::Curl.curl_headers (method)">curl_headers</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_http_content_headers_and_checksum-class_method" title="Utils::Curl.curl_http_content_headers_and_checksum (method)">curl_http_content_headers_and_checksum</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_output-class_method" title="Utils::Curl.curl_output (method)">curl_output</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_path-class_method" title="Utils::Curl.curl_path (method)">curl_path</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_response_follow_redirections-class_method" title="Utils::Curl.curl_response_follow_redirections (method)">curl_response_follow_redirections</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_response_last_location-class_method" title="Utils::Curl.curl_response_last_location (method)">curl_response_last_location</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_supports_tls13%3F-class_method" title="Utils::Curl.curl_supports_tls13? (method)">curl_supports_tls13?</a></span>, <span class='object_link'><a href="Utils/Curl.html#curl_with_workarounds-class_method" title="Utils::Curl.curl_with_workarounds (method)">curl_with_workarounds</a></span>, <span class='object_link'><a href="Utils/Curl.html#http_status_ok%3F-class_method" title="Utils::Curl.http_status_ok? (method)">http_status_ok?</a></span>, <span class='object_link'><a href="Utils/Curl.html#parse_curl_output-class_method" title="Utils::Curl.parse_curl_output (method)">parse_curl_output</a></span>, <span class='object_link'><a href="Utils/Curl.html#url_protected_by_cloudflare%3F-class_method" title="Utils::Curl.url_protected_by_cloudflare? (method)">url_protected_by_cloudflare?</a></span>, <span class='object_link'><a href="Utils/Curl.html#url_protected_by_incapsula%3F-class_method" title="Utils::Curl.url_protected_by_incapsula? (method)">url_protected_by_incapsula?</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="AbstractFileDownloadStrategy.html" title="AbstractFileDownloadStrategy (class)">AbstractFileDownloadStrategy</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="AbstractFileDownloadStrategy.html#basename-instance_method" title="AbstractFileDownloadStrategy#basename (method)">#basename</a></span>, <span class='object_link'><a href="AbstractFileDownloadStrategy.html#cached_location-instance_method" title="AbstractFileDownloadStrategy#cached_location (method)">#cached_location</a></span>, <span class='object_link'><a href="AbstractFileDownloadStrategy.html#symlink_location-instance_method" title="AbstractFileDownloadStrategy#symlink_location (method)">#symlink_location</a></span>, <span class='object_link'><a href="AbstractFileDownloadStrategy.html#temporary_path-instance_method" title="AbstractFileDownloadStrategy#temporary_path (method)">#temporary_path</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="AbstractDownloadStrategy.html" title="AbstractDownloadStrategy (class)">AbstractDownloadStrategy</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="AbstractDownloadStrategy.html#basename-instance_method" title="AbstractDownloadStrategy#basename (method)">#basename</a></span>, <span class='object_link'><a href="AbstractDownloadStrategy.html#quiet!-instance_method" title="AbstractDownloadStrategy#quiet! (method)">#quiet!</a></span>, <span class='object_link'><a href="AbstractDownloadStrategy.html#quiet%3F-instance_method" title="AbstractDownloadStrategy#quiet? (method)">#quiet?</a></span>, <span class='object_link'><a href="AbstractDownloadStrategy.html#shutup!-instance_method" title="AbstractDownloadStrategy#shutup! (method)">#shutup!</a></span>, <span class='object_link'><a href="AbstractDownloadStrategy.html#stage-instance_method" title="AbstractDownloadStrategy#stage (method)">#stage</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Context.html" title="Context (module)">Context</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Context.html#current-class_method" title="Context.current (method)">current</a></span>, <span class='object_link'><a href="Context.html#current=-class_method" title="Context.current= (method)">current=</a></span>, <span class='object_link'><a href="Context.html#debug%3F-instance_method" title="Context#debug? (method)">#debug?</a></span>, <span class='object_link'><a href="Context.html#quiet%3F-instance_method" title="Context#quiet? (method)">#quiet?</a></span>, <span class='object_link'><a href="Context.html#verbose%3F-instance_method" title="Context#verbose? (method)">#verbose?</a></span>, <span class='object_link'><a href="Context.html#with_context-instance_method" title="Context#with_context (method)">#with_context</a></span></p>

  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(url, name, version, **meta)  &#x21d2; <tt><span class='object_link'><a href="" title="CurlDownloadStrategy (class)">CurlDownloadStrategy</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of CurlDownloadStrategy.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


391
392
393
394
395
396
397
398
399
400
401
402</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'download_strategy.rb', line 391</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_meta'>meta</span><span class='rparen'>)</span>
  <span class='ivar'>@try_partial</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@mirrors</span> <span class='op'>=</span> <span class='id identifier rubyid_meta'>meta</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:mirrors</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='comment'># Merge `:header` with `:headers`.
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_header'>header</span> <span class='op'>=</span> <span class='id identifier rubyid_meta'>meta</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:header</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_meta'>meta</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_meta'>meta</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_header'>header</span>
  <span class='kw'>end</span>

  <span class='kw'>super</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="mirrors-instance_method">
  
    #<strong>mirrors</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


389
390
391</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'download_strategy.rb', line 389</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mirrors'>mirrors</span>
  <span class='ivar'>@mirrors</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="clear_cache-instance_method">
  
    #<strong>clear_cache</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


468
469
470
471</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'download_strategy.rb', line 468</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_cache'>clear_cache</span>
  <span class='kw'>super</span>
  <span class='id identifier rubyid_rm_rf'>rm_rf</span><span class='lparen'>(</span><span class='id identifier rubyid_temporary_path'>temporary_path</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch-instance_method">
  
    #<strong>fetch</strong>(timeout: nil)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Download and cache the file at <span class='object_link'><a href="AbstractFileDownloadStrategy.html#cached_location-instance_method" title="AbstractFileDownloadStrategy#cached_location (method)">AbstractFileDownloadStrategy#cached_location</a></span>.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'download_strategy.rb', line 407</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='label'>timeout:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_end_time'>end_time</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='id identifier rubyid_timeout'>timeout</span> <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span>

  <span class='id identifier rubyid_download_lock'>download_lock</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="LockFile.html" title="LockFile (class)">LockFile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="LockFile.html#initialize-instance_method" title="LockFile#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_temporary_path'>temporary_path</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_download_lock'>download_lock</span><span class='period'>.</span><span class='id identifier rubyid_lock'>lock</span>

  <span class='id identifier rubyid_urls'>urls</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_mirrors'>mirrors</span><span class='rbracket'>]</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_url'>url</span> <span class='op'>=</span> <span class='id identifier rubyid_urls'>urls</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>

    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_domain'>domain</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Homebrew/EnvConfig.html" title="Homebrew::EnvConfig (module)">EnvConfig</a></span></span><span class='period'>.</span><span class='id identifier rubyid_artifact_domain'>artifact_domain</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_url'>url</span> <span class='op'>=</span> <span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^https?://</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="GitHubPackages.html" title="GitHubPackages (class)">GitHubPackages</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="GitHubPackages.html#URL_DOMAIN-constant" title="GitHubPackages::URL_DOMAIN (constant)">URL_DOMAIN</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='regexp_end'>}o</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_domain'>domain</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_ohai'>ohai</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Downloading </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_use_cached_location'>use_cached_location</span> <span class='op'>=</span> <span class='id identifier rubyid_cached_location'>cached_location</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span>
    <span class='id identifier rubyid_use_cached_location'>use_cached_location</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_version'>version</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:latest?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_version'>version</span><span class='period'>.</span><span class='id identifier rubyid_latest?'>latest?</span>

    <span class='id identifier rubyid_resolved_url'>resolved_url</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_last_modified'>last_modified</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_is_redirection'>is_redirection</span> <span class='op'>=</span> <span class='kw'>begin</span>
      <span class='id identifier rubyid_resolve_url_basename_time_file_size'>resolve_url_basename_time_file_size</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='const'><span class='object_link'><a href="Utils.html" title="Utils (module)">Utils</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Utils/Timer.html" title="Utils::Timer (module)">Timer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_remaining!'><span class='object_link'><a href="Utils/Timer.html#remaining!-class_method" title="Utils::Timer.remaining! (method)">remaining!</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_end_time'>end_time</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="ErrorDuringExecution.html" title="ErrorDuringExecution (class)">ErrorDuringExecution</a></span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='kw'>unless</span> <span class='id identifier rubyid_use_cached_location'>use_cached_location</span>
    <span class='kw'>end</span>

    <span class='comment'># Authorization is no longer valid after redirects
</span>    <span class='id identifier rubyid_meta'>meta</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_header'>header</span><span class='op'>|</span> <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Authorization</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_is_redirection'>is_redirection</span>

    <span class='comment'># The cached location is no longer fresh if Last-Modified is after the file&#39;s timestamp
</span>    <span class='id identifier rubyid_use_cached_location'>use_cached_location</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_cached_location'>cached_location</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_cached_location'>cached_location</span><span class='period'>.</span><span class='id identifier rubyid_mtime'>mtime</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_use_cached_location'>use_cached_location</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Already downloaded: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cached_location'>cached_location</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid__fetch'>_fetch</span><span class='lparen'>(</span><span class='label'>url:</span> <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='label'>resolved_url:</span> <span class='id identifier rubyid_resolved_url'>resolved_url</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='const'><span class='object_link'><a href="Utils.html" title="Utils (module)">Utils</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Utils/Timer.html" title="Utils::Timer (module)">Timer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_remaining!'><span class='object_link'><a href="Utils/Timer.html#remaining!-class_method" title="Utils::Timer.remaining! (method)">remaining!</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_end_time'>end_time</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="ErrorDuringExecution.html" title="ErrorDuringExecution (class)">ErrorDuringExecution</a></span></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="CurlDownloadStrategyError.html" title="CurlDownloadStrategyError (class)">CurlDownloadStrategyError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_url'>url</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_ignore_interrupts'>ignore_interrupts</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_cached_location'>cached_location</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='period'>.</span><span class='id identifier rubyid_mkpath'>mkpath</span>
        <span class='id identifier rubyid_temporary_path'>temporary_path</span><span class='period'>.</span><span class='id identifier rubyid_rename'>rename</span><span class='lparen'>(</span><span class='id identifier rubyid_cached_location'>cached_location</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_symlink_location'>symlink_location</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='period'>.</span><span class='id identifier rubyid_mkpath'>mkpath</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_ln_s'>ln_s</span> <span class='id identifier rubyid_cached_location'>cached_location</span><span class='period'>.</span><span class='id identifier rubyid_relative_path_from'>relative_path_from</span><span class='lparen'>(</span><span class='id identifier rubyid_symlink_location'>symlink_location</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_symlink_location'>symlink_location</span><span class='comma'>,</span> <span class='label'>force:</span> <span class='kw'>true</span>
  <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="CurlDownloadStrategyError.html" title="CurlDownloadStrategyError (class)">CurlDownloadStrategyError</a></span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='kw'>if</span> <span class='id identifier rubyid_urls'>urls</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Trying a mirror...</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>retry</span>
  <span class='kw'>rescue</span> <span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Timed out downloading </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_download_lock'>download_lock</span><span class='op'>&amp;.</span><span class='id identifier rubyid_unlock'>unlock</span>
  <span class='id identifier rubyid_download_lock'>download_lock</span><span class='op'>&amp;.</span><span class='id identifier rubyid_path'>path</span><span class='op'>&amp;.</span><span class='id identifier rubyid_unlink'>unlink</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resolved_time_file_size-instance_method">
  
    #<strong>resolved_time_file_size</strong>(timeout: nil)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


473
474
475
476</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'download_strategy.rb', line 473</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolved_time_file_size'>resolved_time_file_size</span><span class='lparen'>(</span><span class='label'>timeout:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='id identifier rubyid_file_size'>file_size</span> <span class='op'>=</span> <span class='id identifier rubyid_resolve_url_basename_time_file_size'>resolve_url_basename_time_file_size</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='id identifier rubyid_file_size'>file_size</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>